<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¬ë‚œÂ·ì‹¬ë¦¬ìƒë‹´ ê¸´ê¸‰ ì§€ì› ì‹œìŠ¤í…œ (ê³„ëª…ëŒ€ ì„±ì„œìº í¼ìŠ¤ ë²„ì „)</title>

    <!-- ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f2f4f7;
        }

        header {
            background: #1f6feb;
            padding: 15px;
            color: white;
            font-size: 20px;
            text-align: center;
            font-weight: bold;
        }

        .menu-container {
            display: flex;
            justify-content: space-around;
            margin: 15px 10px;
            gap: 8px;
        }

        .menu-btn {
            background: white;
            border-radius: 12px;
            padding: 12px;
            flex: 1;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .menu-btn:hover {
            background: #e7ecf3;
        }

        #map {
            height: 340px;
            margin: 0 10px;
            border-radius: 12px;
            overflow: hidden;
        }

        #chatbox {
            margin: 20px 10px 30px 10px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #messages {
            height: 180px;
            overflow-y: auto;
            padding: 10px;
            background: #f7f7f7;
            border-radius: 8px;
        }

        .msg-user {
            background: #d0e2ff;
            padding: 8px;
            margin: 6px;
            border-radius: 8px;
            text-align: right;
        }

        .msg-bot {
            background: #fff5cc;
            padding: 8px;
            margin: 6px;
            border-radius: 8px;
            text-align: left;
        }

        #input-area {
            display: flex;
            margin-top: 10px;
        }

        #chat-input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        #send-btn {
            padding: 10px 15px;
            margin-left: 8px;
            background: #1f6feb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        #send-btn:hover {
            background: #155acb;
        }
    </style>

    <!-- Leaflet ì§€ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
<header>
    ì¬ë‚œÂ·ì‹¬ë¦¬ìƒë‹´ ê¸´ê¸‰ ì§€ì› ì‹œìŠ¤í…œ (ê³„ëª…ëŒ€ ì„±ì„œìº í¼ìŠ¤)
</header>

<div class="menu-container">
    <div class="menu-btn" id="btn-my-location">ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸°</div>
    <div class="menu-btn" id="btn-shelter">ğŸ¥ ëŒ€í”¼ì†Œ ë³´ê¸° (ë”ë¯¸)</div>
    <div class="menu-btn" id="btn-reset">ğŸ”„ ì§€ë„ ë¦¬ì…‹</div>
</div>

<div id="map"></div>

<div id="chatbox">
    <h3>ğŸ§‘â€âš•ï¸ ì‹¬ë¦¬ ìƒë‹´ ì±—ë´‡ (ë°ëª¨ ë²„ì „)</h3>
    <div id="messages"></div>

    <div id="input-area">
        <input type="text" id="chat-input" placeholder="ì§€ê¸ˆ ì–´ë–¤ ìƒí™©ì¸ì§€ í¸í•˜ê²Œ ì ì–´ ì£¼ì„¸ìš”." />
        <button id="send-btn">ì „ì†¡</button>
    </div>
</div>

<script>
    /* =========================================
       1) ê¸°ì¤€ ì¢Œí‘œ ì„¤ì •
       -----------------------------------------
       - KMU_LAT / KMU_LON: ê³„ëª…ëŒ€ì—­ ê·¼ì²˜ (ì„±ì„œìº í¼ìŠ¤ ì ‘ê·¼ ê¸°ì¤€)
       - MY_LAT / MY_LON: "í˜„ì¬ ë‚´ ìœ„ì¹˜" = ë´‰ê²½ê´€ ê·¼ì²˜ë¡œ ê³ ì •
       ========================================= */

    // âœ… ê³„ëª…ëŒ€ì—­ ê¸°ì¤€(ìœ„í‚¤ ì¢Œí‘œ) â€“ ìº í¼ìŠ¤ ì¤‘ì•™ ì¯¤ìœ¼ë¡œ ë³´ì´ê²Œ ì‚¬ìš©
    const KMU_LAT = 35.85139;
    const KMU_LON = 128.49167;

    // âœ… "í˜„ì¬ ë‚´ ìœ„ì¹˜" = ë´‰ê²½ê´€ ê·¼ì²˜ë¡œ ì•½ê°„ ë¶ìª½ìœ¼ë¡œ ì˜¬ë ¤ì„œ í‘œì‹œ (ëˆˆìœ¼ë¡œ ë´¤ì„ ë•Œ ìº í¼ìŠ¤ ì•ˆìœ¼ë¡œ ë“¤ì–´ì˜¤ê²Œ)
    const MY_LAT = 35.8530;
    const MY_LON = 128.4917;

    /* =========================================
       2) Leaflet ì§€ë„ ì´ˆê¸°í™”
       ========================================= */
    const map = L.map("map").setView([KMU_LAT, KMU_LON], 16);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19
    }).addTo(map);

    /* =========================================
       3) ì•„ì´ì½˜ ì„¤ì • (íŒŒë€ìƒ‰: ë‚´ ìœ„ì¹˜ / ë¹¨ê°„ìƒ‰: ëŒ€í”¼ì†Œ)
       ========================================= */
    const userIcon = L.icon({
        iconUrl:
            "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",
        shadowUrl:
            "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    const shelterIcon = L.icon({
        iconUrl:
            "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",
        shadowUrl:
            "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    /* =========================================
       4) ê¸°ë³¸ ë§ˆì»¤ (ì²˜ìŒ ì§€ë„ ì—´ì—ˆì„ ë•Œ ê¸°ì¤€ì )
       ========================================= */
    let baseMarker = L.marker([KMU_LAT, KMU_LON], { icon: userIcon })
        .addTo(map)
        .bindPopup("ê³„ëª…ëŒ€ ì„±ì„œìº í¼ìŠ¤ ê·¼ì²˜ (ê¸°ë³¸ ìœ„ì¹˜)")
        .openPopup();

    let myLocationMarker = null;
    let shelterMarkers = [];

    function clearShelters() {
        shelterMarkers.forEach(m => map.removeLayer(m));
        shelterMarkers = [];
    }

    /* =========================================
       5) ë”ë¯¸ ëŒ€í”¼ì†Œ 4ê³³ (ê³„ëª…ëŒ€ ì„±ì„œìº í¼ìŠ¤ ê·¼ì²˜)
       -----------------------------------------
       - ì‹¤ì œ ì¢Œí‘œëŠ” ì•„ë‹ˆê³ , ìº í¼ìŠ¤ ì£¼ë³€ì— ìì—°ìŠ¤ëŸ½ê²Œ ë³´ì´ë„ë¡
         ê¸°ì¤€ì (MY_LAT, MY_LON) ê·¼ì²˜ë¡œ ë°°ì¹˜
       ========================================= */
    const dummyShelters = [
        {
            name: "ì„±ì„œìº í¼ìŠ¤ ëŒ€í”¼ì†Œ 1 (ë”ë¯¸)",
            lat: MY_LAT + 0.0010,
            lon: MY_LON + 0.0010
        },
        {
            name: "ì„±ì„œìº í¼ìŠ¤ ëŒ€í”¼ì†Œ 2 (ë”ë¯¸)",
            lat: MY_LAT + 0.0012,
            lon: MY_LON - 0.0010
        },
        {
            name: "ì„±ì„œìº í¼ìŠ¤ ëŒ€í”¼ì†Œ 3 (ë”ë¯¸)",
            lat: MY_LAT - 0.0010,
            lon: MY_LON + 0.0007
        },
        {
            name: "ì„±ì„œìº í¼ìŠ¤ ëŒ€í”¼ì†Œ 4 (ë”ë¯¸)",
            lat: MY_LAT - 0.0012,
            lon: MY_LON - 0.0008
        }
    ];

    function showDummyShelters() {
        clearShelters();
        dummyShelters.forEach(s => {
            const m = L.marker([s.lat, s.lon], { icon: shelterIcon })
                .addTo(map)
                .bindPopup(`<b>${s.name}</b><br>ì¬ë‚œ ì‹œ í™œìš© ì˜ˆì • ìœ„ì¹˜ (ì˜ˆì‹œ)`);
            shelterMarkers.push(m);
        });

        if (dummyShelters.length > 0) {
            const first = dummyShelters[0];
            map.setView([first.lat, first.lon], 16);
        }
    }

    /* =========================================
       6) ë²„íŠ¼ ê¸°ëŠ¥
       ========================================= */

    // ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸° (ë´‰ê²½ê´€ ê·¼ì²˜ ê³ ì •)
    function goToMyLocation() {
        if (myLocationMarker) {
            map.removeLayer(myLocationMarker);
        }
        myLocationMarker = L.marker([MY_LAT, MY_LON], { icon: userIcon })
            .addTo(map)
            .bindPopup("í˜„ì¬ ë‚´ ìœ„ì¹˜ (ë´‰ê²½ê´€ ê·¼ì²˜ë¡œ ê³ ì •)")
            .openPopup();

        map.setView([MY_LAT, MY_LON], 17);
    }

    // ğŸ”„ ì§€ë„ ë¦¬ì…‹
    function resetMap() {
        map.setView([KMU_LAT, KMU_LON], 16);
        baseMarker.setLatLng([KMU_LAT, KMU_LON]);
        baseMarker.setPopupContent("ê³„ëª…ëŒ€ ì„±ì„œìº í¼ìŠ¤ ê·¼ì²˜ (ê¸°ë³¸ ìœ„ì¹˜)");
        if (myLocationMarker) {
            map.removeLayer(myLocationMarker);
            myLocationMarker = null;
        }
        clearShelters();
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    document.getElementById("btn-my-location").onclick = goToMyLocation;
    document.getElementById("btn-shelter").onclick = showDummyShelters;
    document.getElementById("btn-reset").onclick = resetMap;

    /* =========================================
       7) ì‹¬ë¦¬ ìƒë‹´ ì±—ë´‡ (í”„ë¡ íŠ¸ì—”ë“œ ë°ëª¨)
       ========================================= */
    function addMessage(text, sender) {
        const messages = document.getElementById("messages");
        const div = document.createElement("div");
        div.className = sender === "user" ? "msg-user" : "msg-bot";
        div.innerText = text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    }

    function botReply(userText) {
        // ê°„ë‹¨í•œ ë°ëª¨ ì‘ë‹µ
        const templates = [
            "ì§€ê¸ˆ ìƒí™©ì—ì„œ ë§ì´ ë†€ë¼ê³  ë¶ˆì•ˆí•˜ì‹¤ ìˆ˜ ìˆì–´ìš”. ì ê¹ ì‹¬í˜¸í¡ì„ ì„¸ ë²ˆë§Œ ê°™ì´ í•´ë³¼ê¹Œìš”?",
            "ìŠ¤ìŠ¤ë¡œë¥¼ íƒ“í•˜ê¸°ë³´ë‹¤ëŠ”, ì—¬ê¸°ê¹Œì§€ ë²„í…¨ì˜¨ ë‚˜ë¥¼ ì¡°ê¸ˆë§Œ ì¸ì •í•´ ì£¼ë©´ ì¢‹ê² ì–´ìš”.",
            "í˜¹ì‹œ ì§€ê¸ˆ ì£¼ë³€ì— í•¨ê»˜ ìˆëŠ” ì‚¬ëŒì´ ìˆë‹¤ë©´, ì§§ê²Œë¼ë„ ë„ì›€ì„ ìš”ì²­í•´ ë³´ëŠ” ê²ƒë„ ì¢‹ì•„ìš”.",
            "ì¡°ê¸ˆì”© ì²œì²œíˆ ì–˜ê¸°í•´ ì£¼ì…”ë„ ê´œì°®ì•„ìš”. ê¸‰í•˜ê²Œ ì„¤ëª…í•˜ì§€ ì•Šì•„ë„ ë¼ìš”."
        ];
        const pick = templates[Math.floor(Math.random() * templates.length)];
        return pick;
    }

    function sendMessage() {
        const input = document.getElementById("chat-input");
        const message = input.value.trim();
        if (!message) return;

        addMessage(message, "user");
        input.value = "";

        setTimeout(() => {
            const reply = botReply(message);
            addMessage(reply, "bot");
        }, 500);
    }

    document.getElementById("send-btn").onclick = sendMessage;
    document
        .getElementById("chat-input")
        .addEventListener("keydown", e => {
            if (e.key === "Enter") sendMessage();
        });
</script>
</body>
</html>
