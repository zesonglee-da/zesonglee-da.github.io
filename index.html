<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¬ë‚œÂ·ì‹¬ë¦¬ìƒë‹´ ê¸´ê¸‰ ì§€ì› ë°ëª¨</title>

    <!-- Leaflet ì§€ë„ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --primary:#1f6feb;
            --bg:#f2f4f7;
        }

        * { box-sizing:border-box; }

        body {
            margin:0;
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
            background:var(--bg);
            color:#111827;
        }

        header {
            background:var(--primary);
            color:#fff;
            padding:14px 16px;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        header h1{
            font-size:17px;
            margin:0;
        }
        header span{
            font-size:11px;
            opacity:.9;
        }

        .container{
            padding:12px;
            max-width:960px;
            margin:0 auto 24px;
        }

        /* ìƒë‹¨ íƒ­ */
        .tabs{
            display:flex;
            gap:8px;
            overflow-x:auto;
            padding-bottom:6px;
        }
        .tab-btn{
            flex:1;
            min-width:110px;
            border:none;
            padding:8px;
            border-radius:999px;
            font-size:12px;
            background:#e5e7eb;
            cursor:pointer;
            white-space:nowrap;
        }
        .tab-btn.active{
            background:#111827;
            color:#fff;
        }

        /* ì¹´ë“œ ê³µí†µ */
        .card{
            background:#fff;
            border-radius:14px;
            padding:12px 14px;
            margin-top:10px;
            box-shadow:0 4px 10px rgba(15,23,42,0.08);
        }
        .card h2{
            font-size:15px;
            margin:0 0 6px;
        }
        .card p{
            font-size:12px;
            margin:0 0 8px;
            color:#4b5563;
        }
        .tag{
            display:inline-block;
            font-size:11px;
            background:#eff6ff;
            color:#1d4ed8;
            padding:2px 6px;
            border-radius:999px;
            margin-bottom:4px;
        }

        /* ì§€ë„ */
        #map{
            height:260px;
            border-radius:12px;
            overflow:hidden;
            margin-top:8px;
        }
        .map-controls{
            display:flex;
            gap:6px;
            margin-top:8px;
        }
        .small-btn{
            flex:1;
            border:none;
            font-size:11px;
            padding:6px;
            border-radius:999px;
            background:#e5e7eb;
            cursor:pointer;
        }
        .small-btn.primary{
            background:var(--primary);
            color:#fff;
        }

        /* ì¬ë‚œë¬¸ì */
        .alert-list{
            display:flex;
            gap:6px;
            flex-wrap:wrap;
            margin-top:6px;
        }
        .alert-chip{
            border:none;
            font-size:11px;
            padding:6px 8px;
            border-radius:999px;
            background:#e5e7eb;
            cursor:pointer;
        }
        .alert-view{
            margin-top:8px;
            background:#111827;
            color:#fefce8;
            padding:10px;
            border-radius:10px;
            font-size:11px;
            white-space:pre-line;
        }

        /* ì±—ë´‡ */
        #chatbox{
            display:flex;
            flex-direction:column;
            gap:8px;
        }
        #messages{
            height:220px;
            overflow-y:auto;
            padding:8px;
            background:#f9fafb;
            border-radius:10px;
        }
        .msg-user,.msg-bot{
            max-width:80%;
            padding:7px 9px;
            margin:4px 0;
            border-radius:10px;
            font-size:12px;
            line-height:1.4;
        }
        .msg-user{
            margin-left:auto;
            background:#dbeafe;
            text-align:right;
        }
        .msg-bot{
            margin-right:auto;
            background:#fef9c3;
        }
        .msg-meta{
            font-size:10px;
            color:#6b7280;
            margin-top:2px;
        }
        #input-area{
            display:flex;
            gap:6px;
        }
        #chat-input{
            flex:1;
            font-size:13px;
            padding:8px;
            border-radius:999px;
            border:1px solid:#d1d5db;
        }
        #send-btn{
            border:none;
            padding:8px 12px;
            border-radius:999px;
            background:var(--primary);
            color:#fff;
            font-size:13px;
            cursor:pointer;
        }

        /* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
        .checklist-group{
            margin-top:4px;
        }
        .checklist-title{
            font-size:13px;
            font-weight:600;
            margin:6px 0 4px;
        }
        .check-item{
            display:flex;
            align-items:center;
            gap:6px;
            font-size:12px;
            margin-bottom:3px;
        }
        .check-item input{
            width:14px;
            height:14px;
        }

        /* ê°€ì´ë“œ */
        .step{
            font-size:12px;
            margin:4px 0;
        }
        .step span{
            font-weight:600;
            color:#1f2937;
        }
        .pill-row{
            display:flex;
            flex-wrap:wrap;
            gap:6px;
            margin-top:4px;
        }
        .pill{
            font-size:11px;
            padding:4px 8px;
            border-radius:999px;
            background:#e5e7eb;
        }
        #breath-counter{
            font-size:26px;
            text-align:center;
            margin-top:6px;
            font-weight:700;
        }
        #breath-phase{
            text-align:center;
            font-size:12px;
            color:#6b7280;
        }
        #breath-btn{
            margin-top:6px;
            width:100%;
            border:none;
            padding:7px;
            border-radius:999px;
            background:#16a34a;
            color:#fff;
            font-size:13px;
            cursor:pointer;
        }

        /* íƒ­ ë‚´ìš© ìˆ¨ê¹€ */
        .tab-panel{ display:none; }
        .tab-panel.active{ display:block; }

        @media (min-width:768px){
            #map{height:320px;}
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>ì¬ë‚œÂ·ì‹¬ë¦¬ìƒë‹´ ê¸´ê¸‰ ì§€ì› ë°ëª¨</h1>
        <span>API ì—†ì´ ë™ì‘í•˜ëŠ” í”„ë¡œí† íƒ€ì… (í•™ìƒ ê°œì¸ìš©)</span>
    </div>
</header>

<div class="container">

    <!-- ìƒë‹¨ íƒ­ -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="tab-overview">í™ˆ ê°œìš”</button>
        <button class="tab-btn" data-tab="tab-map">ëŒ€í”¼ì†ŒÂ·ì§€ë„</button>
        <button class="tab-btn" data-tab="tab-alerts">ì¬ë‚œë¬¸ì ì‹œë®¬ë ˆì´í„°</button>
        <button class="tab-btn" data-tab="tab-chat">ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡</button>
        <button class="tab-btn" data-tab="tab-check">ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
        <button class="tab-btn" data-tab="tab-guide">ì‹¬ë¦¬ ì•ˆì • ê°€ì´ë“œ</button>
    </div>

    <!-- íƒ­: ê°œìš” -->
    <section id="tab-overview" class="tab-panel active">
        <div class="card">
            <span class="tag">Demo Prototype</span>
            <h2>ì´ ì‚¬ì´íŠ¸ëŠ” ë¬´ì—‡ì„ í•˜ëŠ” ê³³ì¸ê°€ìš”?</h2>
            <p>
                ì¬ë‚œ ìƒí™©ì—ì„œ ì‹œë¯¼ì˜ <b>ë¬¼ë¦¬ì  ì•ˆì „(ëŒ€í”¼ì†Œ ì •ë³´)</b>ì™€ <b>ì‹¬ë¦¬ì  ì•ˆì •(ìƒë‹´Â·í˜¸í¡ ê°€ì´ë“œ)</b>ì„ ë™ì‹œì— ì§€ì›í•˜ëŠ”
                ë°ëª¨ ì›¹ì•±ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” <b>ì‹¤ì œ ì •ë¶€ API ì—†ì´</b> ì˜ˆì‹œ ë°ì´í„°ì™€ ê°„ë‹¨í•œ ë¡œì§ë§Œìœ¼ë¡œ ë™ì‘í•˜ëŠ” <b>í”„ë¡œí† íƒ€ì…</b>ì…ë‹ˆë‹¤.
            </p>
            <ul style="font-size:12px; padding-left:18px; margin:0;">
                <li>ğŸ¥ ì§€ë„ ìœ„ì— <b>ì˜ˆì‹œ ëŒ€í”¼ì†Œ</b>ì™€ ìœ„í—˜ì§€ì—­ì„ ì‹œê°í™”</li>
                <li>ğŸ“¢ <b>ì¬ë‚œë¬¸ì ì‹œë®¬ë ˆì´í„°</b>ë¡œ ë‹¤ì–‘í•œ ìƒí™© ì—°ìŠµ</li>
                <li>ğŸ§‘â€âš•ï¸ <b>ë£° ê¸°ë°˜ ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡</b>ìœ¼ë¡œ ê¸°ë³¸ì ì¸ ì •ì„œì§€ì§€ ì œê³µ</li>
                <li>âœ… <b>ëŒ€í”¼Â·ì‹¬ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</b>ë¥¼ ë¡œì»¬ì— ì €ì¥í•´ì„œ ë°˜ë³µ í™œìš©</li>
                <li>ğŸŒ¿ <b>í˜¸í¡Â·ê·¸ë¼ìš´ë”© ê°€ì´ë“œ</b>ë¡œ ë¶ˆì•ˆ ì™„í™” ì—°ìŠµ</li>
            </ul>
        </div>
    </section>

    <!-- íƒ­: ì§€ë„ -->
    <section id="tab-map" class="tab-panel">
        <div class="card">
            <span class="tag">Map Â· Shelter</span>
            <h2>ëŒ€í”¼ì†Œ ë° ìœ„í—˜ì§€ì—­ (ì˜ˆì‹œ ë°ì´í„°)</h2>
            <p>í˜„ì¬ ìœ„ì¹˜(íŒŒë€ í•€)ì™€ ì˜ˆì‹œ ëŒ€í”¼ì†Œ(ë¹¨ê°„ í•€), ìœ„í—˜ì§€ì—­(ë…¸ë€ ì›)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ëŠ” <b>ì„ì˜ ì˜ˆì‹œ</b>ì…ë‹ˆë‹¤.</p>

            <div id="map"></div>

            <div class="map-controls">
                <button class="small-btn primary" id="btn-mypos">ğŸ“ ë‚´ ìœ„ì¹˜ ì°¾ê¸°</button>
                <button class="small-btn" id="btn-shelters">ğŸ¥ ëŒ€í”¼ì†Œ í‘œì‹œ</button>
                <button class="small-btn" id="btn-risk">âš  ìœ„í—˜ì§€ì—­ í‘œì‹œ</button>
            </div>
        </div>
    </section>

    <!-- íƒ­: ì¬ë‚œë¬¸ì ì‹œë®¬ -->
    <section id="tab-alerts" class="tab-panel">
        <div class="card">
            <span class="tag">Alert Simulator</span>
            <h2>ì¬ë‚œë¬¸ì ì‹œë®¬ë ˆì´í„°</h2>
            <p>ì‹¤ì œ ì¬ë‚œë¬¸ìë¥¼ ëŒ€ì‹ í•´, ìƒí™©ì„ ì„ íƒí•˜ë©´ ì˜ˆì‹œ ì¬ë‚œë¬¸ìê°€ ì•„ë˜ì— í‘œì‹œë©ë‹ˆë‹¤.</p>

            <div class="alert-list" id="alert-buttons"></div>

            <div class="alert-view" id="alert-view">
[ì¬ë‚œë¬¸ì ì˜ˆì‹œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤]
            </div>
        </div>
    </section>

    <!-- íƒ­: ì±—ë´‡ -->
    <section id="tab-chat" class="tab-panel">
        <div class="card">
            <span class="tag">Psychological First Aid</span>
            <h2>ğŸ§‘â€âš•ï¸ ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡ (ë£° ê¸°ë°˜)</h2>
            <p>ì•„ë˜ ì…ë ¥ì°½ì— ì§€ê¸ˆ ìƒí™©ì´ë‚˜ ê°ì •ì„ ì ì–´ì£¼ì„¸ìš”. ê°„ë‹¨í•œ ê·œì¹™ì— ë”°ë¼ ì •ì„œì§€ì§€ìš© ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.</p>

            <div id="chatbox">
                <div id="messages"></div>
                <div id="input-area">
                    <input id="chat-input" type="text" placeholder="ì˜ˆ: ê³„ì† ì§€ì§„ ë‰´ìŠ¤ê°€ ë‚˜ì˜¤ë‹ˆê¹Œ ë„ˆë¬´ ë¶ˆì•ˆí•´ìš”" />
                    <button id="send-btn">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </section>

    <!-- íƒ­: ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
    <section id="tab-check" class="tab-panel">
        <div class="card">
            <span class="tag">Checklist</span>
            <h2>ëŒ€í”¼Â·ì‹¬ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
            <p>ì²´í¬ ìƒíƒœëŠ” ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤(ë¡œì»¬ìŠ¤í† ë¦¬ì§€). ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.</p>

            <div id="checklists"></div>
        </div>
    </section>

    <!-- íƒ­: ì‹¬ë¦¬ ì•ˆì • ê°€ì´ë“œ -->
    <section id="tab-guide" class="tab-panel">
        <div class="card">
            <span class="tag">Self-care Guide</span>
            <h2>í˜¸í¡Â·ê·¸ë¼ìš´ë”© ì‹¬ë¦¬ ì•ˆì • ê°€ì´ë“œ</h2>
            <p>ì•„ì£¼ ë¶ˆì•ˆí•  ë•Œ ë”°ë¼ í•  ìˆ˜ ìˆëŠ” ì§§ì€ ì‹¬ë¦¬ ì•ˆì • ìŠ¤í…ì…ë‹ˆë‹¤.</p>

            <div class="step"><span>1ë‹¨ê³„.</span> ì£¼ë³€ì´ ë¹„êµì  ì•ˆì „í•œì§€ ë¨¼ì € í™•ì¸í•©ë‹ˆë‹¤.</div>
            <div class="step"><span>2ë‹¨ê³„.</span> ìˆ¨ì„ 4ì´ˆ ë™ì•ˆ ë“¤ì´ë§ˆì‹œê³ , 6ì´ˆ ë™ì•ˆ ì²œì²œíˆ ë‚´ì‰½ë‹ˆë‹¤.</div>
            <div class="step"><span>3ë‹¨ê³„.</span> ì§€ê¸ˆ ë‚´ê°€ ë³´ê³ , ë“£ê³ , ëŠë¼ëŠ” ê°ê°ì— ì ì‹œ ì§‘ì¤‘í•´ë´…ë‹ˆë‹¤.</div>
            <div class="step"><span>4ë‹¨ê³„.</span> â€œì§€ê¸ˆ ì´ ìˆœê°„, ë‚˜ëŠ” ìµœì„ ì„ ë‹¤í•´ ì•ˆì „ì„ ì§€í‚¤ê³  ìˆë‹¤â€ë¼ê³  ë§ˆìŒì†ìœ¼ë¡œ ë˜ë‡Œì–´ ë´…ë‹ˆë‹¤.</div>

            <div class="pill-row">
                <div class="pill">ğŸ‘€ ë³´ì´ëŠ” ê²ƒ 5ê°€ì§€</div>
                <div class="pill">ğŸ‘‚ ë“¤ë¦¬ëŠ” ì†Œë¦¬ 4ê°€ì§€</div>
                <div class="pill">ğŸ¤š ë§Œì ¸ì§€ëŠ” ì´‰ê° 3ê°€ì§€</div>
                <div class="pill">ğŸ‘ƒ ë§¡ì„ ìˆ˜ ìˆëŠ” ëƒ„ìƒˆ 2ê°€ì§€</div>
                <div class="pill">ğŸ‘… ëŠê»´ì§€ëŠ” ë§› 1ê°€ì§€</div>
            </div>

            <div id="breath-counter">10</div>
            <div id="breath-phase">ì ì‹œ ë’¤, í˜¸í¡ ì—°ìŠµì´ ì‹œì‘ë©ë‹ˆë‹¤.</div>
            <button id="breath-btn">10ì´ˆ í˜¸í¡ ì•ˆì • ì—°ìŠµ ì‹œì‘</button>
        </div>
    </section>
</div>

<script>
    /* ========== íƒ­ ì „í™˜ ========== */
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            tabButtons.forEach(b => b.classList.remove('active'));
            tabPanels.forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.dataset.tab).classList.add('active');
        });
    });

    /* ========== ì§€ë„ & ë”ë¯¸ ëŒ€í”¼ì†Œ ========== */
    const userIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
        shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
        iconSize:[25,41],
        iconAnchor:[12,41],
        popupAnchor:[1,-34],
        shadowSize:[41,41]
    });

    const shelterIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
        shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
        iconSize:[25,41],
        iconAnchor:[12,41],
        popupAnchor:[1,-34],
        shadowSize:[41,41]
    });

    const map = L.map('map').setView([37.5665, 126.9780], 12); // ì„œìš¸

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        maxZoom:19
    }).addTo(map);

    let userMarker = L.marker([37.5665,126.9780],{icon:userIcon})
        .addTo(map).bindPopup('ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­ ê·¼ì²˜)').openPopup();

    const dummyShelters = [
        { name:"ì„œìš¸ì‹œì²­ ì• ê´‘ì¥ ëŒ€í”¼ì†Œ", lat:37.5668, lon:126.9785 },
        { name:"ë•ìˆ˜ê¶ ëŒë‹´ê¸¸ ì˜¥ì™¸ëŒ€í”¼ì†Œ", lat:37.5663, lon:126.9750 },
        { name:"ë‚¨ì‚° ê³µì› ì˜¥ì™¸ëŒ€í”¼ì†Œ", lat:37.5509, lon:126.9904 },
        { name:"ìš©ì‚°ê°€ì¡±ê³µì› ì˜¥ì™¸ëŒ€í”¼ì†Œ", lat:37.5234, lon:126.9806 }
    ];
    let shelterMarkers = [];
    let riskCircles = [];

    function clearShelters(){
        shelterMarkers.forEach(m => map.removeLayer(m));
        shelterMarkers = [];
    }
    function clearRisks(){
        riskCircles.forEach(c => map.removeLayer(c));
        riskCircles = [];
    }

    document.getElementById('btn-mypos').onclick = () => {
        if (!navigator.geolocation){
            alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            map.setView([lat,lon], 15);
            if (userMarker) map.removeLayer(userMarker);
            userMarker = L.marker([lat,lon],{icon:userIcon}).addTo(map)
                .bindPopup("í˜„ì¬ ë‚´ ìœ„ì¹˜").openPopup();
        }, () => {
            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        });
    };

    document.getElementById('btn-shelters').onclick = () => {
        clearShelters();
        dummyShelters.forEach(s => {
            const m = L.marker([s.lat,s.lon],{icon:shelterIcon})
                .addTo(map)
                .bindPopup(`<b>${s.name}</b><br>ì˜ˆì‹œ ëŒ€í”¼ì†Œ ìœ„ì¹˜ (ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)`);
            shelterMarkers.push(m);
        });
    };

    document.getElementById('btn-risk').onclick = () => {
        clearRisks();
        const dummyRisk = [
            { lat:37.565, lon:126.982, radius:500, level:"ì¹¨ìˆ˜ ìœ„í—˜" },
            { lat:37.555, lon:126.975, radius:400, level:"í˜¼ì¡ ì§€ì—­" }
        ];
        dummyRisk.forEach(r => {
            const circle = L.circle([r.lat,r.lon],{
                radius:r.radius,
                color:"#f97316",
                fillColor:"#facc15",
                fillOpacity:0.35
            }).addTo(map).bindPopup(`âš  ${r.level} (ì˜ˆì‹œ ë°ì´í„°)`);
            riskCircles.push(circle);
        });
    };

    /* ========== ì¬ë‚œë¬¸ì ì‹œë®¬ë ˆì´í„° ========== */
    const alertPresets = [
        {
            id:"earthquake",
            label:"ì§€ì§„ (ì•¼ê°„)",
            text:
"[í–‰ì •ì•ˆì „ë¶€ ì¬ë‚œë¬¸ì]\n\nì˜¤ëŠ˜ 23:14 ê²½ ì¸ê·¼ ì§€ì—­ì—ì„œ ê·œëª¨ 4.1 ì§€ì§„ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në–¨ë¦¼ì„ ëŠë‚€ ê²½ìš° íƒì ì•„ë˜ë¡œ ëª¸ì„ ë³´í˜¸í•˜ê³  ë–¨ì–´ì§€ëŠ” ë¬¼ê±´ì— ì£¼ì˜í•˜ì‹­ì‹œì˜¤.\nì—˜ë¦¬ë² ì´í„° ì‚¬ìš©ì„ ìì œí•˜ê³ , TVÂ·ë¼ë””ì˜¤Â·ê³µì‹ì•±ì„ í†µí•´ ì•ˆë‚´ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”."
        },
        {
            id:"flood",
            label:"í˜¸ìš°Â·ì¹¨ìˆ˜",
            text:
"[í–‰ì •ì•ˆì „ë¶€ ì¬ë‚œë¬¸ì]\n\nì‹œê°„ë‹¹ 50mm ì´ìƒì˜ ê°•í•œ ë¹„ê°€ ì˜ˆë³´ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•˜ì²œë³€, ì§€í•˜ì°¨ë„, ë°˜ì§€í•˜ ê±°ì£¼ìëŠ” ì¦‰ì‹œ ì•ˆì „í•œ ê³³ìœ¼ë¡œ ì´ë™í•´ ì£¼ì‹­ì‹œì˜¤.\nì°¨ëŸ‰ì€ ì¹¨ìˆ˜ ìš°ë ¤ ì§€ì—­ì„ í”¼í•´ì„œ ìš´í–‰í•´ ì£¼ì„¸ìš”."
        },
        {
            id:"fire",
            label:"ëŒ€í˜• í™”ì¬",
            text:
"[ì†Œë°©ì²­ ì¬ë‚œë¬¸ì]\n\nëŒ€í˜• í™”ì¬ ë°œìƒìœ¼ë¡œ ì¸ê·¼ ì§€ì—­ ëŒ€ê¸° ì˜¤ì—¼ì´ ìš°ë ¤ë©ë‹ˆë‹¤.\nì°½ë¬¸ê³¼ ì¶œì…ë¬¸ì„ ë‹«ê³  ì‹¤ë‚´ì— ë¨¸ë¬¼ëŸ¬ì£¼ì‹œê³ ,\ní˜¸í¡ê¸° ì§ˆí™˜ìëŠ” ì™¸ì¶œì„ ìì œí•´ ì£¼ì„¸ìš”."
        },
        {
            id:"heat",
            label:"í­ì—¼Â·ì˜¨ì—´ì§ˆí™˜",
            text:
"[í–‰ì •ì•ˆì „ë¶€ ì¬ë‚œë¬¸ì]\n\ní­ì—¼ ê²½ë³´ê°€ ë°œë ¹ë˜ì—ˆìŠµë‹ˆë‹¤.\në‚® 12~17ì‹œ ì•¼ì™¸ í™œë™ì„ ìì œí•˜ê³ ,\në¬¼ì„ ìì£¼ ë§ˆì‹œë©°, ì–´ë¦°ì´Â·ë…¸ì•½ìÂ·ë°˜ë ¤ë™ë¬¼ì˜ ì°¨ëŸ‰ ë°©ì¹˜ë¥¼ ì ˆëŒ€ ê¸ˆì§€í•´ ì£¼ì„¸ìš”."
        }
    ];

    const alertButtonsContainer = document.getElementById('alert-buttons');
    const alertView = document.getElementById('alert-view');

    alertPresets.forEach(p => {
        const btn = document.createElement('button');
        btn.className = 'alert-chip';
        btn.innerText = p.label;
        btn.onclick = () => {
            alertView.innerText = p.text;
        };
        alertButtonsContainer.appendChild(btn);
    });

    /* ========== ë£° ê¸°ë°˜ ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡ ========== */
    const messagesEl = document.getElementById('messages');

    function addMessage(text, sender) {
        const wrapper = document.createElement('div');
        const bubble = document.createElement('div');
        bubble.className = sender === 'user' ? 'msg-user' : 'msg-bot';
        bubble.innerText = text;
        wrapper.appendChild(bubble);

        const meta = document.createElement('div');
        meta.className = 'msg-meta';
        const now = new Date();
        const t = now.toTimeString().slice(0,5);
        meta.innerText = sender === 'user' ? `ë‚˜ Â· ${t}` : `ìƒë‹´ë´‡ Â· ${t}`;
        wrapper.appendChild(meta);

        messagesEl.appendChild(wrapper);
        messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // ìµœì´ˆ ì¸ì‚¬
    addMessage(
        "ì¬ë‚œ ìƒí™©ì—ì„œ ëŠë¼ëŠ” ë¶ˆì•ˆ, ë‘ë ¤ì›€, ë‹µë‹µí•¨ì„ í¸í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”.\nìœ„í—˜ í–‰ë™ì„ í•˜ë ¤ëŠ” ìƒê°ì´ ë“ ë‹¤ë©´, ë°˜ë“œì‹œ 112 Â· 119 ë˜ëŠ” ì£¼ë³€ ì–´ë¥¸ì—ê²Œ ì¦‰ì‹œ ë„ì›€ì„ ìš”ì²­í•˜ì„¸ìš”.",
        "bot"
    );

    function ruleBasedReply(message) {
        const msg = message.toLowerCase();

        if (msg.includes("ë¶ˆì•ˆ") || msg.includes("ê±±ì •") || msg.includes("ì´ˆì¡°")) {
            return "ë¶ˆì•ˆê°ì´ ì˜¤ë˜ ì§€ì†ë˜ë©´ ëª¸ë„ ë§ì´ ì§€ì¹˜ì£ . ì§€ê¸ˆ ì ê¹ì´ë¼ë„ ìˆ¨ì„ 4ì´ˆ ë™ì•ˆ ë“¤ì´ë§ˆì‹œê³  6ì´ˆ ë™ì•ˆ ë‚´ì‰¬ëŠ” í˜¸í¡ì„ 5íšŒ ì •ë„ ë°˜ë³µí•´ë³¼ê¹Œìš”? ê·¸ë¦¬ê³  ì§€ê¸ˆ ì‹¤ì œë¡œ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” 'ì•„ì£¼ ì‘ì€ í–‰ë™' í•œ ê°€ì§€ë§Œ ë– ì˜¬ë ¤ ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤.";
        }
        if (msg.includes("ë¬´ì„­") || msg.includes("ê³µí¬") || msg.includes("ë‘ë µ")) {
            return "ì§€ê¸ˆ ë§ì´ ë¬´ì„­ê³  ë‘ë ¤ìš´ ë§ˆìŒì´ ë“œëŠ” ê²ƒ ê°™ì•„ìš”. ê·¸ ê°ì •ì€ ì•„ì£¼ ìì—°ìŠ¤ëŸ¬ìš´ ë°˜ì‘ì…ë‹ˆë‹¤. ì£¼ë³€ì— ë¯¿ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒ(ê°€ì¡±, ì¹œêµ¬, ì„ ìƒë‹˜)ì´ ìˆë‹¤ë©´ ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •ì„ ì†”ì§í•˜ê²Œ í•œ ë¬¸ì¥ë§Œì´ë¼ë„ ë§í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?";
        }
        if (msg.includes("ì ") || msg.includes("ìˆ˜ë©´") || msg.includes("ì•…ëª½")) {
            return "ì¬ë‚œ í›„ì—ëŠ” ì ì´ ì˜ ì˜¤ì§€ ì•Šê±°ë‚˜, ì•…ëª½ì„ ê¾¸ëŠ” ì¼ì´ í”í•˜ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì ìê¸° 30ë¶„ ì „ì—ëŠ” ë‰´ìŠ¤ë¥¼ ì ì‹œ êº¼ë‘ê³ , ì¡°ìš©í•œ ìŒì•…ì´ë‚˜ ë°ì§€ ì•Šì€ ì¡°ëª…ì„ ì‚¬ìš©í•´ ëª¸ì—ê²Œ 'ì´ì œ ì‰´ ì‹œê°„'ì´ë¼ëŠ” ì‹ í˜¸ë¥¼ ë³´ë‚´ì£¼ëŠ” ê²ƒì´ ë„ì›€ ë  ìˆ˜ ìˆì–´ìš”.";
        }
        if (msg.includes("ì£½ê³ ") || msg.includes("ì‚´ê¸° ì‹«") || msg.includes("ìì‚´") || msg.includes("ëë‚´ê³ ")) {
            return "ì§€ê¸ˆ ì •ë§ ë§ì´ í˜ë“  ìƒíƒœë¼ëŠ” ê²Œ ëŠê»´ì ¸ìš”. ì´ëŸ° ìƒê°ì„ í˜¼ìë§Œ ê°€ì§€ê³  ìˆìœ¼ë©´ ìœ„í—˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ë°˜ë“œì‹œ ì£¼ë³€ ì–´ë¥¸ì´ë‚˜ ì „ë¬¸ê°€ì—ê²Œ ì•Œë ¤ì•¼ í•©ë‹ˆë‹¤.\n\nğŸ“ ê¸´ê¸‰ ìƒí™©ì´ë¼ë©´ 112 ë˜ëŠ” 119ì— ë°”ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.\nğŸ“ ìƒë‹´ì´ í•„ìš”í•˜ë‹¤ë©´ 1393(ìì‚´ì˜ˆë°© ìƒë‹´ì „í™”)ì´ë‚˜ 129(ë³µì§€ ìƒë‹´)ë¥¼ í†µí•´ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”.\n\në‹¹ì‹ ì˜ ìƒëª…ì€ ì–´ë–¤ ì¬ë‚œ ìƒí™©ë³´ë‹¤ ì†Œì¤‘í•©ë‹ˆë‹¤.";
        }
        if (msg.includes("í™”ê°€") || msg.includes("ì§œì¦") || msg.includes("ë¶„ë…¸")) {
            return "ì¬ë‚œ ì´í›„ì—ëŠ” ë¶ˆì•ˆë¿ ì•„ë‹ˆë¼ ë¶„ë…¸ì™€ ì§œì¦ë„ ë§ì´ ì˜¬ë¼ì˜¬ ìˆ˜ ìˆì–´ìš”. ì§€ê¸ˆ í™”ê°€ ë‚˜ëŠ” ì´ìœ ë¥¼ 'ìƒí™©Â·ìƒê°Â·ê°ì •' ì„¸ ê°€ì§€ë¡œ ë¶„ë¦¬í•´ì„œ ì ì–´ë³´ë©´ ê°ì •ì— íœ©ì“¸ë¦¬ëŠ” ì •ë„ê°€ ì¡°ê¸ˆ ì¤„ì–´ë“­ë‹ˆë‹¤.";
        }
        if (msg.includes("ë„ì›€") || msg.includes("ì–´ë–»ê²Œ") || msg.includes("ë°©ë²•")) {
            return "ë„ì›€ì„ ìš”ì²­í•´ ì¤€ ê²ƒ ìì²´ê°€ ì´ë¯¸ í° ìš©ê¸°ì…ë‹ˆë‹¤. ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” ê²ƒì€\n1) ë‚´ ëª¸ì„ ì•ˆì „í•œ ê³³ìœ¼ë¡œ ì˜®ê¸°ê³ \n2) ìˆ¨ì„ ê³ ë¥´ê³ \n3) ë¯¿ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒ ë˜ëŠ” ê¸°ê´€ì— ì—°ë½í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\ní•„ìš”í•˜ë‹¤ë©´ ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ì„ ê°„ë‹¨íˆ ì •ë¦¬í•´ì„œ ëˆ„êµ°ê°€ì—ê²Œ ë³´ì—¬ì£¼ëŠ” ê²ƒë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.";
        }

        return "ì§€ê¸ˆ ë“¤ë ¤ì¤€ ì´ì•¼ê¸°ë§Œ ë´ë„ ë§ì´ ë²„í…¨ë‚´ê³  ìˆë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ìš”. ì´ ìƒí™©ì„ í˜¼ì ê°ë‹¹í•˜ë ¤ í•˜ê¸°ë³´ë‹¤ëŠ”, ë¯¿ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì—ê²Œ ì§€ê¸ˆì˜ ë§ˆìŒì„ í•œ ë¬¸ì¥ë§Œì´ë¼ë„ ë‚˜ëˆ ë³´ê³ , ì ê¹ì´ë¼ë„ ëª¸ì„ í¸í•˜ê²Œ ê¸°ëŒ€ì–´ ì‰´ ìˆ˜ ìˆëŠ” ê³µê°„ì„ ì°¾ì•„ë³´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n\nì›í•œë‹¤ë©´, ì§€ê¸ˆ ìƒí™©ì„ ì¡°ê¸ˆ ë” ìì„¸íˆ ì ì–´ì¤„ë˜ìš”?";
    }

    function sendMessage() {
        const input = document.getElementById("chat-input");
        const text = input.value.trim();
        if (!text) return;
        addMessage(text, "user");
        input.value = "";

        setTimeout(() => {
            const reply = ruleBasedReply(text);
            addMessage(reply, "bot");
        }, 400);
    }

    document.getElementById("send-btn").addEventListener("click", sendMessage);
    document.getElementById("chat-input").addEventListener("keydown", e => {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });

    /* ========== ì²´í¬ë¦¬ìŠ¤íŠ¸ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€) ========== */
    const checklistData = [
        {
            id:"shelter",
            title:"ë¹„ìƒ ëŒ€í”¼ ì¤€ë¹„ë¬¼",
            items:[
                "íœ´ëŒ€í° ë° ë³´ì¡° ë°°í„°ë¦¬",
                "ë¬¼, ê°„ë‹¨í•œ ë¹„ìƒì‹ëŸ‰",
                "í•„ìˆ˜ ë³µìš© ì•½, ì•ˆê²½/ë Œì¦ˆ",
                "ë§ˆìŠ¤í¬, ì† ì†Œë…ì œ",
                "í˜„ê¸ˆ, ê°„ë‹¨í•œ ì‹ ë¶„ í™•ì¸ ì„œë¥˜"
            ]
        },
        {
            id:"home",
            title:"ì§‘ ì•ˆ ì ê²€",
            items:[
                "ê°€ìŠ¤ ë°¸ë¸Œ ì°¨ë‹¨ ìœ„ì¹˜ í™•ì¸",
                "ì—˜ë¦¬ë² ì´í„° ëŒ€ì‹  ê³„ë‹¨ ëŒ€í”¼ ê³„íš",
                "ê°€ì¡±Â·ë™ê±°ì¸ ëŒ€í”¼ ìœ„ì¹˜ í•©ì˜",
                "ë¹„ìƒ ì—°ë½ì²˜ë¥¼ ëˆˆì— ì˜ ë³´ì´ëŠ” ê³³ì— ë¶™ì—¬ë‘ê¸°"
            ]
        },
        {
            id:"mind",
            title:"ë§ˆìŒ ëŒë³´ê¸° ì²´í¬",
            items:[
                "ì˜¤ëŠ˜ ë‚´ê°€ ë²„í…¨ë‚¸ ê²ƒ í•œ ê°€ì§€ ë– ì˜¬ë¦¬ê¸°",
                "ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •ì„ í•œ ë‹¨ì–´ë¡œ ì ì–´ë³´ê¸°",
                "ëª¸ì— í˜ì„ ì²œì²œíˆ ì£¼ì—ˆë‹¤ê°€ ë¹¼ëŠ” ê¸´ì¥ ì´ì™„ 3íšŒ",
                "ë„ì›€ì´ í•„ìš”í•˜ë©´ ìš”ì²­í•´ë„ ëœë‹¤ëŠ” ê²ƒ ë– ì˜¬ë¦¬ê¸°"
            ]
        }
    ];

    const checklistRoot = document.getElementById('checklists');

    function loadChecklistState(){
        try{
            const raw = localStorage.getItem("disaster_checklist_state") || "{}";
            return JSON.parse(raw);
        }catch(e){
            return {};
        }
    }
    function saveChecklistState(state){
        localStorage.setItem("disaster_checklist_state", JSON.stringify(state));
    }

    let checklistState = loadChecklistState();

    function renderChecklists(){
        checklistRoot.innerHTML = "";
        checklistData.forEach(group => {
            const gDiv = document.createElement('div');
            gDiv.className = 'checklist-group';

            const title = document.createElement('div');
            title.className = 'checklist-title';
            title.innerText = group.title;
            gDiv.appendChild(title);

            group.items.forEach((item, idx) => {
                const row = document.createElement('label');
                row.className = 'check-item';

                const input = document.createElement('input');
                input.type = "checkbox";
                const key = `${group.id}_${idx}`;
                input.checked = !!checklistState[key];
                input.onchange = () => {
                    checklistState[key] = input.checked;
                    saveChecklistState(checklistState);
                };

                const span = document.createElement('span');
                span.innerText = item;

                row.appendChild(input);
                row.appendChild(span);
                gDiv.appendChild(row);
            });

            checklistRoot.appendChild(gDiv);
        });
    }
    renderChecklists();

    /* ========== í˜¸í¡ ì¹´ìš´í„° ========== */
    const breathCounter = document.getElementById('breath-counter');
    const breathPhase = document.getElementById('breath-phase');
    const breathBtn = document.getElementById('breath-btn');
    let breathInterval = null;

    breathBtn.onclick = () => {
        if (breathInterval){
            clearInterval(breathInterval);
            breathInterval = null;
        }
        let timeLeft = 10;
        breathCounter.innerText = timeLeft;
        breathPhase.innerText = "4ì´ˆ ë“¤ì´ë§ˆì‹œê³  Â· 6ì´ˆ ë‚´ì‰¬ëŠ” ë¦¬ë“¬ì„ ë”°ë¼ê°€ ì£¼ì„¸ìš”.";
        breathBtn.disabled = true;

        breathInterval = setInterval(() => {
            timeLeft--;
            breathCounter.innerText = timeLeft;
            if (timeLeft <= 0){
                clearInterval(breathInterval);
                breathInterval = null;
                breathPhase.innerText = "ìˆ˜ê³ í–ˆì–´ìš”. í•„ìš”í•˜ë‹¤ë©´ í•œ ë²ˆ ë” ì—°ìŠµí•´ë³¼ê¹Œìš”?";
                breathBtn.disabled = false;
                breathCounter.innerText = "10";
            }
        }, 1000);
    };
</script>

</body>
</html>
